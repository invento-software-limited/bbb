{
  "version": 3,
  "sources": ["../../../../../apps/bbb/bbb/public/js/point_of_sale/pos_item_cart.bundle.js"],
  "sourcesContent": ["erpnext.PointOfSale.ItemCart = class {\n    constructor({wrapper, events, settings}) {\n        this.wrapper = wrapper;\n        this.events = events;\n        this.customer_info = undefined;\n        this.served_by_info = undefined;\n        this.ignore_discount = undefined;\n        this.ignore_pricing_rule = \"No\";\n        this.hide_images = settings.hide_images;\n        this.allowed_customer_groups = settings.customer_groups;\n        this.allow_rate_change = settings.allow_rate_change;\n        this.allow_discount_change = settings.allow_discount_change;\n        this.init_component();\n    }\n\n    init_component() {\n        this.prepare_dom();\n        this.init_child_components();\n        this.bind_events();\n        this.attach_shortcuts();\n    }\n\n    prepare_dom() {\n        this.wrapper.append(\n            `<section class=\"customer-cart-container\"></section>`\n        )\n\n        this.$component = this.wrapper.find('.customer-cart-container');\n\n    }\n\n    init_child_components() {\n        this.init_customer_selector();\n        this.init_cart_components();\n    }\n\n    init_customer_selector() {\n        this.$component.append(\n            `<div class=\"customer-header-section\"></div>`\n        );\n        this.$customer_header_section = this.$component.find('.customer-header-section');\n        this.$customer_header_section.append(\n            `<div class=\"customer-section\"></div>`\n        );\n        this.$customer_header_section.append(\n            `<div class=\"served-by-section\"></div>`\n        );\n        this.$customer_header_section.append(\n            `<div class=\"pricing-discount-section\"></div>`\n        );\n        this.$customer_header_section.append(\n            `<div class=\"pos-profile-section\"></div>`\n        );\n        this.$customer_header_section.append(\n            `<div class=\"menu-section\"></div>`\n        );\n\n\n        this.$customer_section = this.$customer_header_section.find('.customer-section');\n        this.$served_by_section = this.$customer_header_section.find('.served-by-section');\n        this.$pricing_rule_discount_section = this.$customer_header_section.find('.pricing-discount-section');\n        this.$menu_section = this.$customer_header_section.find('.menu-section');\n        this.$pos_profile_section = this.$customer_header_section.find('.pos-profile-section');\n\n        this.make_customer_selector();\n        this.make_served_by_selector();\n        this.make_discount_price_selector();\n        this.make_menu_dropdown();\n    }\n\n    reset_customer_selector() {\n        const frm = this.events.get_frm();\n        if(frm.doc.is_return === 1) return;\n        // if($('.checkout-btn').is(\":visible\")) return;\n        frm.set_value('customer', '');\n        this.make_customer_selector();\n        this.customer_field.set_focus();\n    }\n\n    reset_served_by_selector() {\n        const frm = this.events.get_frm();\n        if(frm.doc.is_return === 1) return;\n        // if($('.checkout-btn').is(\":visible\")) return;\n\n        frm.set_value('served_by', '');\n        this.make_served_by_selector();\n        this.served_by_field.set_focus();\n    }\n    reset_ignore_discount_selector() {\n        const frm = this.events.get_frm();\n        if(frm.doc.is_return === 1) return;\n        // if($('.checkout-btn').is(\":visible\")) return;\n        frm.set_value('ignore_pricing_rule', 0);\n        this.make_discount_price_selector();\n        this.price_rule_ignore_discount_field.set_focus();\n    }\n\n    init_cart_components() {\n        this.$component.append(\n            `<div class=\"cart-container\">\n\t\t\t\t<div class=\"abs-cart-container\">\n<!--\t\t\t\t\t<div class=\"cart-label\">Item Cart</div>-->\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t\t<div class=\"name-header\">Product</div>\n\t\t\t\t\t\t<div class=\"mrp-header\">MRP</div>\n\t\t\t\t\t\t<div class=\"discount-header\">Disc</div>\n\t\t\t\t\t\t<div class=\"damaged-header\">Damaged</div>\n\t\t\t\t\t\t<div class=\"after-discount-header\">After Disc</div>\n\t\t\t\t\t\t<div class=\"qty-header\">Qty</div>\n\t\t\t\t\t\t<div class=\"rate-amount-header\">Amount</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\"></div>\n\t\t\t\t\t<div class=\"cart-totals-section\"></div>\n\t\t\t\t\t<div class=\"numpad-section\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n        );\n        this.$cart_container = this.$component.find('.cart-container');\n\n        this.make_cart_totals_section();\n        this.make_cart_items_section();\n        this.make_cart_numpad();\n    }\n\n    make_cart_items_section() {\n        this.$cart_header = this.$component.find('.cart-header');\n        this.$cart_items_wrapper = this.$component.find('.cart-items-section');\n\n        this.make_no_items_placeholder();\n    }\n\n    make_no_items_placeholder() {\n        this.$cart_header.css('display', 'none');\n        this.$cart_items_wrapper.html(\n            `<div class=\"no-item-wrapper\">No items in cart</div>`\n        );\n    }\n\n    get_discount_icon() {\n        return (\n            `<svg class=\"discount-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M19 15.6213C19 15.2235 19.158 14.842 19.4393 14.5607L20.9393 13.0607C21.5251 12.4749 21.5251 11.5251 20.9393 10.9393L19.4393 9.43934C19.158 9.15804 19 8.7765 19 8.37868V6.5C19 5.67157 18.3284 5 17.5 5H15.6213C15.2235 5 14.842 4.84196 14.5607 4.56066L13.0607 3.06066C12.4749 2.47487 11.5251 2.47487 10.9393 3.06066L9.43934 4.56066C9.15804 4.84196 8.7765 5 8.37868 5H6.5C5.67157 5 5 5.67157 5 6.5V8.37868C5 8.7765 4.84196 9.15804 4.56066 9.43934L3.06066 10.9393C2.47487 11.5251 2.47487 12.4749 3.06066 13.0607L4.56066 14.5607C4.84196 14.842 5 15.2235 5 15.6213V17.5C5 18.3284 5.67157 19 6.5 19H8.37868C8.7765 19 9.15804 19.158 9.43934 19.4393L10.9393 20.9393C11.5251 21.5251 12.4749 21.5251 13.0607 20.9393L14.5607 19.4393C14.842 19.158 15.2235 19 15.6213 19H17.5C18.3284 19 19 18.3284 19 17.5V15.6213Z\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15 9L9 15\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M10.5 9.5C10.5 10.0523 10.0523 10.5 9.5 10.5C8.94772 10.5 8.5 10.0523 8.5 9.5C8.5 8.94772 8.94772 8.5 9.5 8.5C10.0523 8.5 10.5 8.94772 10.5 9.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15.5 14.5C15.5 15.0523 15.0523 15.5 14.5 15.5C13.9477 15.5 13.5 15.0523 13.5 14.5C13.5 13.9477 13.9477 13.5 14.5 13.5C15.0523 13.5 15.5 13.9477 15.5 14.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t</svg>`\n        );\n    }\n\n    make_cart_totals_section() {\n        this.$totals_section = this.$component.find('.cart-totals-section');\n\n        this.$totals_section.append(\n            `<div class=\"total-section\">\n                <div class=\"total-label\" >Total</div>\n                <div class=\"mrp-label\" >0</div>\n                <div class=\"disc-label\" >0</div>\n                <div class=\"damaged-label\" >0</div>\n                <div class=\"after-disc-label\" >0</div>\n                <div class=\"qty-label\" >0</div>\n                <div class=\"final-amount-total-label\">0</div>\n            </div>\n            <div class=\"additional-discount-section\">\n                 <div class=\"add-discount-wrapper\" can_click=\"enabled\">\n                    ${this.get_discount_icon()} Add Discount\n                </div>\n                <div class=\"add-discount-amount-wrapper\" style=\"display:none\" can_click=\"enabled\">\n                     Add Discount Amount\n                </div>\n            </div>\n            <div class=\"row\">\n                <div class=\"col-md-6\">\n                \t<div class=\"net-total-container\">\n                        <div class=\"net-total-label\">Net Total</div>\n                        <div class=\"net-total-value\">0.00</div>\n                    </div>\n                    <div class=\"taxes-container\"></div>\n                    <div class=\"special-discount-container\">\n                        <div>Special Discount</div>\n                        <div>0.00</div>\n                    </div>\n               </div>\n                <div class=\"col-md-6\">\n                    <div class=\"grand-total-container\">\n                        <div>Grand Total</div>\n                        <div>0.00</div>\n                    </div>\n                    <div class=\"rounding-adjustment-container\">\n                        <div>Rounding Adjustment</div>\n                        <div>0.00</div>\n                    </div>\n                     <div class=\"rounded-total-container\">\n                        <div>Rounded Total</div>\n                        <div>0.00</div>\n                    </div>\n                </div>\n            </div>\n\t\t\t<div class=\"checkout-btn\">Checkout</div>\n\t\t\t<div class=\"edit-cart-btn\">Edit Cart</div>`\n        );\n        $('.total-section').css('visibility', 'hidden');\n        this.$add_discount_elem = this.$component.find(\".add-discount-wrapper\");\n        this.$add_discount_amount_elem = this.$component.find(\".add-discount-amount-wrapper\");\n    }\n\n    make_cart_numpad() {\n        this.$numpad_section = this.$component.find('.numpad-section');\n\n        this.number_pad = new erpnext.PointOfSale.NumberPad({\n            wrapper: this.$numpad_section,\n            events: {\n                numpad_event: this.on_numpad_event.bind(this)\n            },\n            cols: 5,\n            keys: [\n                [1, 2, 3, 'Quantity'],\n                [4, 5, 6, 'Discount'],\n                [7, 8, 9, 'Rate'],\n                ['-', 0, 'Delete', 'Remove']\n            ],\n            css_classes: [\n                ['', '', '', 'col-span-2'],\n                ['', '', '', 'col-span-2'],\n                ['', '', '', 'col-span-2'],\n                ['', '', '', 'col-span-2 remove-btn']\n            ],\n            fieldnames_map: {'Quantity': 'qty', 'Discount': 'discount_percentage'}\n        })\n\n        this.$numpad_section.prepend(\n            `<div class=\"numpad-totals\">\n\t\t\t\t<span class=\"numpad-net-total\"></span>\n\t\t\t\t<span class=\"numpad-grand-total\"></span>\n\t\t\t</div>`\n        )\n\n        this.$numpad_section.append(\n            `<div class=\"numpad-btn checkout-btn\" data-button-value=\"checkout\">Checkout</div>`\n        )\n    }\n\n    bind_events() {\n        const me = this;\n        this.$customer_section.on('click', '.reset-customer-btn', function () {\n            me.reset_customer_selector();\n        });\n\n        this.$served_by_section.on('click', '.reset-served-by-btn', function () {\n            me.reset_served_by_selector();\n        });\n        this.$pricing_rule_discount_section.on('click', '.reset-ignore_pricing-rule-btn', function () {\n            me.reset_ignore_discount_selector();\n        });\n\n        this.$customer_section.on('click', '.close-details-btn', function () {\n            // me.toggle_customer_info(false);\n        });\n\n        this.$customer_section.on('click', '.customer-display', function (e) {\n            // if ($(e.target).closest('.reset-customer-btn').length) return;\n            //\n            // const show = me.$cart_container.is(':visible');\n            // me.toggle_customer_info(show);\n        });\n\n        this.$cart_items_wrapper.on('click', '.cart-item-wrapper', function () {\n            const $cart_item = $(this);\n\n            me.toggle_item_highlight(this);\n\n            const payment_section_hidden = !me.$totals_section.find('.edit-cart-btn').is(':visible');\n            if (!payment_section_hidden) {\n                // payment section is visible\n                // edit cart first and then open item details section\n                me.$totals_section.find(\".edit-cart-btn\").click();\n            }\n\n            const item_row_name = unescape($cart_item.attr('data-row-name'));\n            me.events.cart_item_clicked({name: item_row_name});\n            this.numpad_value = '';\n        });\n\n        this.$component.on('click', '.checkout-btn', function () {\n            if ($(this).attr('style').indexOf('--blue-500') == -1) return;\n            const frm = me.events.get_frm();\n            let rounded_total = frm.doc.rounded_total;\n            let payments = frm.doc.payments;\n            payments[0].amount = rounded_total;\n            payments[0].base_amount =rounded_total;\n            frappe.model.set_value(frm.doctype, frm.docname, 'paid_amount', rounded_total);\n            $(\".add-discount-wrapper\").attr('can_click','disabled');\n            $(\".add-discount-amount-wrapper\").attr('can_click','disabled');\n            me.wrapper.find('.customer-cart-container').css('grid-column', 'span 5 / span 5');\n            me.events.checkout();\n            me.toggle_checkout_btn(false);\n            //rabi\n            if(!frm.doc.additional_discount_percentage || frm.doc.additional_discount_percentage === 0){\n                frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', 0);\n                me.$add_discount_elem.css({\n                    'border': '1px dashed var(--gray-500)',\n                    'padding': 'var(--padding-sm) var(--padding-md)'\n                });\n                me.$add_discount_elem.html(`${me.get_discount_icon()} Add Discount`);\n                me.discount_field = undefined;\n            }\n            if(!frm.doc.discount_amount || frm.doc.discount_amount === 0) {\n                frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'discount_amount', 0);\n                me.$add_discount_amount_elem.css({\n                    'border': '1px dashed var(--gray-500)',\n                    'padding': 'var(--padding-sm) var(--padding-md)'\n                });\n                me.$add_discount_amount_elem.html(`${me.get_discount_icon()} Add Discount`);\n                me.discount_amount_field = undefined;\n            }\n            if(frm.doc.discount_amount || frm.doc.discount_percentage){\n                // me.hide_discount_control(frm.doc.discount_percentage);\n                this.$add_discount_elem.css({\n                    'border': '1px dashed var(--dark-green-500)',\n                    'padding': 'var(--padding-sm) var(--padding-md)'\n                });\n                this.$add_discount_elem.html(\n                    `<div class=\"edit-discount-btn\">\n                        ${this.get_discount_icon()} ${String(frm.doc.discount_percentage ? frm.doc.discount_percentage : 0).bold()}% discount applied\n                    </div>`\n                );\n                // me.hide_discount_amount_control(frm.doc.discount_amount);\n\n                this.$add_discount_amount_elem.css({\n                    'border': '1px dashed var(--dark-green-500)',\n                    'padding': 'var(--padding-sm) var(--padding-md)'\n                });\n                this.$add_discount_amount_elem.html(\n                    `<div class=\"edit-discount-amount-btn\">\n                        ${this.get_discount_icon()} ${String(frm.doc.discount_amount).bold()}&nbsp;TK discount applied\n                    </div>`\n                );\n            }\n\n            //\n            // me.allow_discount_change && me.$add_discount_elem.removeClass(\"d-none\");\n            // me.allow_discount_change && me.$add_discount_amount_elem.removeClass(\"d-none\");\n\n            $('.reset-customer-btn').css('display', 'none');\n            $('.reset-served-by-btn').css('display', 'none');\n            $('.reset-ignore_pricing-rule-btn').css('display', 'none');\n\n\n        });\n\n        this.$totals_section.on('click', '.edit-cart-btn', () => {\n            $(\".add-discount-wrapper\").attr('can_click','enabled');\n            $(\".add-discount-amount-wrapper\").attr('can_click','enabled');\n            me.wrapper.find('.customer-cart-container').css('grid-column', 'span 7 / span 7');\n            this.events.edit_cart();\n            this.toggle_checkout_btn(true);\n            const frm = me.events.get_frm();\n            if(frm.doc.is_return === 0) {\n                $('.reset-customer-btn').css('display', 'flex');\n                $('.reset-served-by-btn').css('display', 'flex');\n                // $('.reset-ignore_pricing-rule-btn').css('display', 'flex');\n            }else{\n                $('.reset-customer-btn').css('display', 'none');\n                $('.reset-served-by-btn').css('display', 'none');\n                $('.reset-ignore_pricing-rule-btn').css('display', 'none');\n            }\n        });\n\n        this.$component.on('click', '.add-discount-wrapper', () => {\n            const can_edit_discount = this.$add_discount_elem.find('.edit-discount-btn').length;\n            const can_click = $(\".add-discount-wrapper\").attr('can_click');\n\n            if(can_click === 'enabled'){\n                if (!this.discount_field || can_edit_discount){\n                    this.show_discount_amount_control();\n                    this.show_discount_control();\n                }\n            }\n        });\n        this.$component.on('click', '.add-discount-amount-wrapper', () => {\n            const can_edit_discount = this.$add_discount_amount_elem.find('.edit-discount-amount-btn').length;\n            const can_click = $(\".add-discount-amount-wrapper\").attr('can_click');\n            if(can_click === 'enabled'){\n                if (!this.discount_field || can_edit_discount){\n                    this.show_discount_control();\n                    this.show_discount_amount_control();\n                }\n            }\n\n        });\n\n        frappe.ui.form.on(\"POS Invoice\", \"paid_amount\", frm => {\n            // called when discount is applied\n            this.update_totals_section(frm);\n        });\n    }\n\n    attach_shortcuts() {\n        for (let row of this.number_pad.keys) {\n            for (let btn of row) {\n                if (typeof btn !== 'string') continue; // do not make shortcuts for numbers\n\n                let shortcut_key = `ctrl+${frappe.scrub(String(btn))[0]}`;\n                if (btn === 'Delete') shortcut_key = 'ctrl+backspace';\n                if (btn === 'Remove') shortcut_key = 'shift+ctrl+backspace';\n                if (btn === '.') shortcut_key = 'ctrl+>';\n\n                // to account for fieldname map\n                const fieldname = this.number_pad.fieldnames[btn] ? this.number_pad.fieldnames[btn] :\n                    typeof btn === 'string' ? frappe.scrub(btn) : btn;\n\n                let shortcut_label = shortcut_key.split('+').map(frappe.utils.to_title_case).join('+');\n                shortcut_label = frappe.utils.is_mac() ? shortcut_label.replace('Ctrl', '\u2318') : shortcut_label;\n                this.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).attr(\"title\", shortcut_label);\n\n                frappe.ui.keys.on(`${shortcut_key}`, () => {\n                    const cart_is_visible = this.$component.is(\":visible\");\n                    if (cart_is_visible && this.item_is_selected && this.$numpad_section.is(\":visible\")) {\n                        this.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).click();\n                    }\n                })\n            }\n        }\n        const ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n        this.$component.find(\".checkout-btn\").attr(\"title\", `${ctrl_label}+Enter`);\n        frappe.ui.keys.add_shortcut({\n            shortcut: \"ctrl+enter\",\n            action: () => this.$component.find(\".checkout-btn\").click(),\n            condition: () => this.$component.is(\":visible\") && !this.$totals_section.find('.edit-cart-btn').is(':visible') && this.wrapper.find('.customer-cart-container').css('grid-column', 'span 5 / span 5'),\n            description: __(\"Checkout Order / Submit Order / New Order\"),\n            ignore_inputs: true,\n            page: cur_page.page.page\n        });\n        this.$component.find(\".edit-cart-btn\").attr(\"title\", `${ctrl_label}+E`);\n        frappe.ui.keys.on(\"ctrl+e\", () => {\n            const item_cart_visible = this.$component.is(\":visible\");\n            const checkout_btn_invisible = !this.$totals_section.find('.checkout-btn').is('visible');\n            if (item_cart_visible && checkout_btn_invisible) {\n                this.wrapper.find('.customer-cart-container').css('grid-column', 'span 7 / span 7')\n                this.$component.find(\".edit-cart-btn\").click();\n            }\n        });\n        this.$component.find(\".add-discount-wrapper\").attr(\"title\", `${ctrl_label}+D`);\n        frappe.ui.keys.add_shortcut({\n            shortcut: \"ctrl+d\",\n            action: () => this.$component.find(\".add-discount-wrapper\").click(),\n            condition: () => this.$add_discount_elem.is(\":visible\") && this.$add_discount_amount_elem.is(':visible'),\n            description: __(\"Add Order Discount\"),\n            ignore_inputs: true,\n            page: cur_page.page.page\n        });\n        frappe.ui.keys.on(\"escape\", () => {\n            const item_cart_visible = this.$component.is(\":visible\");\n            if (item_cart_visible && this.discount_field && this.discount_field.parent.is(\":visible\")) {\n                this.discount_field.set_value(0);\n            }\n            if (item_cart_visible && this.discount_amount_field && this.discount_field.parent.is(\":visible\")) {\n                this.discount_field.set_value(0);\n            }\n        });\n    }\n\n    toggle_item_highlight(item) {\n        const $cart_item = $(item);\n        const item_is_highlighted = $cart_item.attr(\"style\") == 'background-color: var(--blue-100);';\n        if (!item || item_is_highlighted) {\n            this.item_is_selected = false;\n            this.$cart_container.find('.cart-item-wrapper').css(\"background-color\", \"\");\n        } else {\n            $cart_item.css(\"background-color\", \"var(--blue-100)\");\n            this.item_is_selected = true;\n            this.$cart_container.find('.cart-item-wrapper').not(item).css(\"background-color\", \"\");\n        }\n    }\n\n    make_customer_selector() {\n        this.$customer_section.html(`\n\t\t\t<div class=\"customer-field\"></div>\n\t\t`);\n        const me = this;\n        const query = {query: 'bbb.controllers.utils.customer_query'};\n        const allowed_customer_group = this.allowed_customer_groups || [];\n        if (allowed_customer_group.length) {\n            query.filters = {\n                customer_group: ['in', allowed_customer_group]\n            }\n        }\n        this.customer_field = frappe.ui.form.make_control({\n            df: {\n                label: __('Customer'),\n                fieldtype: 'Link',\n                options: 'Customer',\n                placeholder: __('Search by customer name, phone, email.'),\n                get_query: () => query,\n                onchange: function () {\n                    if (this.value) {\n                        const frm = me.events.get_frm();\n                        frappe.dom.freeze();\n                        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', this.value);\n                        frm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n                            frappe.run_serially([\n                                () => me.fetch_customer_details(this.value),\n                                () => me.events.customer_details_updated(me.customer_info),\n                                () => me.update_customer_section(),\n                                () => me.update_totals_section(),\n                                // () => me.events.set_cache_data({'pos_customer': this.value}),\n                                // () => me.check_out_validation(true),\n                                () => frappe.dom.unfreeze()\n                            ]);\n                        })\n                    }\n                },\n            },\n            parent: this.$customer_section.find('.customer-field'),\n            render_input: true,\n        });\n        this.customer_field.toggle_label(false);\n    }\n\n    make_served_by_selector() {\n        this.$served_by_section.html(`\n\t\t\t<div class=\"served-by-field\"></div>\n\t\t`);\n        const me = this;\n        const query = {query: 'bbb.bbb.controllers.queries.served_by_query'};\n\n        this.served_by_field = frappe.ui.form.make_control({\n            df: {\n                label: __('Served By'),\n                fieldtype: 'Link',\n                options: 'Served By',\n                placeholder: __('Search by name, location'),\n                get_query: () => query,\n                onchange: function () {\n                    if (this.value) {\n                        frappe.dom.freeze();\n                        const frm = me.events.get_frm();\n                        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'served_by', this.value);\n                        frappe.db.get_value('Served By', {'served_by_name': this.value}, 'disabled')\n                        .then(r => {\n                            if(r.message.disabled == 0){\n                                frm.script_manager.trigger('served_by', frm.doc.doctype, frm.doc.name);\n                                frappe.run_serially([\n                                    // () => me.check_out_validation(true),\n                                    () => me.served_by_info = {'served_by': this.value},\n                                    // () => me.events.set_cache_data({'pos_served_by': this.value}),\n                                    () => me.update_served_by_section(),\n                                    () => frappe.dom.unfreeze()\n                                ]);\n                            }else{\n                                frappe.msgprint({\n                                    title: __('Warning'),\n                                    indicator: 'red',\n                                    message: __('Disabled users cannot be added')\n                                });\n                                frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'served_by', '');\n                                frappe.dom.unfreeze()\n                            }\n                        })\n\n\n                    }\n                },\n            },\n            parent: this.$served_by_section.find('.served-by-field'),\n            render_input: true,\n        });\n        this.served_by_field.toggle_label(false);\n    }\n\n    make_pos_profile() {\n        const frm = this.events.get_frm();\n        const html = `\n        <div class=\"label\"><span class=\"indicator-pill whitespace-nowrap blue\"><span></span id=\"pos-profile-label\">${frm.doc.pos_profile}</span></div>\n    `\n        this.$pos_profile_section.html(`\n            <div class=\"pos-profile-field\">${html}</div>\n        `);\n    }\n    make_discount_price_selector() {\n        const me = this;\n        const html = `\n        <div class=\"ignore-pricing-rule-field\">\n            <div class=\"frappe-control input-max-width\" data-fieldtype=\"Select\">\n                <div class=\"form-group\"><div class=\"clearfix\">\n                    <label class=\"control-label hide\" style=\"padding-right: 0px;\">Ignore Discount</label>\n                </div>\n                <div class=\"control-input-wrapper\">\n                    <div class=\"control-input flex align-center\">\n                        <select type=\"text\" id=\"ignore_pricing_rule\" autocomplete=\"off\" class=\"input-with-feedback form-control ellipsis\" maxlength=\"140\" data-fieldtype=\"Select\" placeholder=\"Ignore Discount\">\n                            <option></option>\n                            <option value=\"Yes\">Yes</option>\n                            <option value=\"No\">No</option>\n                       </select>\n                    <div class=\"select-icon \"><svg class=\"icon  icon-sm\" style=\"\"><use class=\"\" href=\"#icon-select\"></use></svg>\n                </div>\n                <div class=\"placeholder ellipsis text-extra-muted \"><span>Ignore Discount</span></div>\n            </div>\n            <div class=\"control-value like-disabled-input\" style=\"display: none;\"></div>\n            <p class=\"help-box small text-muted\"></p>\n        </div>\n        `\n        this.$pricing_rule_discount_section.html(`\n\t\t\t<div class=\"ignore-pricing-rule-field\">${html}</div>\n\t\t`);\n        $('#ignore_pricing_rule').on('change', function (){\n            frappe.run_serially([\n                // () => me.ignore_pricing_rule = this.value,\n                () => me.update_pricing_rule_discount_section(this.value),\n                // () => me.events.set_cache_data({'pos_ignore_pricing_rule': this.value}),\n                () => me.ignore_pricing_discount(me, this.value),\n                () => frappe.dom.unfreeze(),\n            ]);\n        })\n        // this.price_rule_ignore_discount_field = frappe.ui.form.make_control({\n        //     df: {\n        //         label: __('Ignore Discount'),\n        //         fieldtype: 'Select',\n        //         options: [\"\", \"Yes\", \"No\"],\n        //         placeholder: __('Ignore Discount'),\n        //         default: 'No',\n        //         onchange: function () {\n        //             console.log(this.value)\n        //             if (this.value) {\n        //                 frappe.dom.freeze();\n        //                 console.log(\"called ..\")\n        //                 const frm = me.events.get_frm();\n        //                 frappe.run_serially([\n        //                     // () => me.ignore_pricing_rule = this.value,\n        //                     () => me.update_pricing_rule_discount_section(this.value),\n        //                     // () => me.events.set_cache_data({'pos_ignore_pricing_rule': this.value}),\n        //                     () => me.ignore_pricing_discount(me, this.value),\n        //                     () => frappe.dom.unfreeze(),\n        //                 ]);\n        //\n        //             }\n        //         },\n        //     },\n        //     parent: this.$pricing_rule_discount_section.find('.ignore-pricing-rule-field'),\n        //     render_input: true,\n        // });\n        // this.price_rule_ignore_discount_field.toggle_label(false);\n    }\n\n\n    make_menu_dropdown() {\n        // this.events.toggle_recent_order();\n        this.$menu_section.html(`\n               <div class=\"menu-dropdown-field\">\n                    <div class=\"menu-btn-group\">\n                        <button type=\"button\" class=\"btn btn-default icon-btn\" data-toggle=\"dropdown\" aria-expanded=\"false\" title=\"\"\n                                data-original-title=\"Menu\"><span>         <span class=\"menu-btn-group-label\" data-label=\"\">          <svg\n                                class=\"icon icon-sm\">           <use xlink:href=\"#icon-dot-horizontal\">           </use>          </svg>         </span>        </span>\n                        </button>\n                        <ul class=\"dropdown-menu dropdown-menu-right\" role=\"menu\">\n                            <li>\n                                <a class=\"grey-link dropdown-item\" href=\"#\" id=\"check_item_stock\">\n                                    <span class=\"menu-item-label\" data-label=\"Check Item Stock\"><span class=\"alt-underline\">C</span>heck Item Stock</span>\n                                </a>\n                            </li>\n<!--                            <li>-->\n<!--                                <a class=\"grey-link dropdown-item\" href=\"#\" id=\"add_damaged_product\">-->\n<!--                                    <span class=\"menu-item-label\" data-label=\"\"><span class=\"alt-underline\">A</span>dd Damaged Product</span>-->\n<!--                                </a>-->\n<!--                            </li>-->\n                            <li>\n                                <a class=\"grey-link dropdown-item\" href=\"#\" id=\"reset_cart\">\n\n                                    <span class=\"menu-item-label\" data-label=\"Reset Cart\"><span class=\"alt-underline\">R</span>eset Cart</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class=\"grey-link dropdown-item toggle_recent_order-1\" href=\"#\" id=\"toggle_recent_order\">\n\n                                    <span class=\"menu-item-label\" data-label=\"Toggle Sidebar\"><span class=\"alt-underline\">T</span>oggle Recent Orders</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class=\"grey-link dropdown-item\" href=\"#\" id=\"save_draft_invoice\">\n\n                                    <span class=\"menu-item-label\" data-label=\"Toggle Sidebar\"><span class=\"alt-underline\">S</span>ave as Draft</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class=\"grey-link dropdown-item\" href=\"#\" id=\"close_pos\">\n\n                                    <span class=\"menu-item-label\" data-label=\"Toggle Sidebar\"><span class=\"alt-underline\">C</span>lose the POS</span>\n                                </a>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n\t\t`);\n        const me = this;\n\n        // this.page.add_menu_item(__(\"Open Form View\"), this.open_form_view.bind(this), false, 'Ctrl+F');\n        //\n        // this.page.add_menu_item(__(\"Toggle Recent Orders\"), this.toggle_recent_order.bind(this), false, 'Ctrl+O');\n        //\n        // this.page.add_menu_item(__(\"Save as Draft\"), this.save_draft_invoice.bind(this), false, 'Ctrl+S');\n        //\n        // this.page.add_menu_item(__('Close the POS'), this.close_pos.bind(this), false, 'Shift+Ctrl+C');\n\n        // this.page.add_menu_item(__(\"Stock\"), function() {\n        //     console.log(\"Stock\")\n        // })\n    }\n\n    fetch_discount_details(ignore_pricing_rule) {\n        return new Promise((resolve) => {\n            if(ignore_pricing_rule === 1){\n                this.ignore_pricing_rule = \"Yes\"\n            }else{\n                this.ignore_pricing_rule = \"No\"\n            }\n            resolve();\n        });\n    }\n\n    fetch_served_by_details(served_by) {\n        if (served_by) {\n            return new Promise((resolve) => {\n                frappe.db.get_value('Served By', served_by, [\"served_by_name\"]).then(({message}) => {\n                    this.served_by_info = {...message, served_by};\n                    resolve();\n                });\n            });\n        } else {\n            return new Promise((resolve) => {\n                this.served_by_info = {}\n                resolve();\n            });\n        }\n    }\n\n    fetch_customer_details(customer) {\n        if (customer) {\n            return new Promise((resolve) => {\n                frappe.db.get_value('Customer', customer, [\"email_id\", \"mobile_no\", \"image\", \"loyalty_program\", \"customer_name\"]).then(({message}) => {\n                    const {loyalty_program} = message;\n                    // if loyalty program then fetch loyalty points too\n                    if (loyalty_program) {\n                        frappe.call({\n                            method: \"erpnext.accounts.doctype.loyalty_program.loyalty_program.get_loyalty_program_details_with_points\",\n                            args: {customer, loyalty_program, \"silent\": true},\n                            callback: (r) => {\n                                const {loyalty_points, conversion_factor} = r.message;\n                                if (!r.exc) {\n                                    this.customer_info = {...message, customer, loyalty_points, conversion_factor};\n\n                                    resolve();\n                                }\n                            }\n                        });\n                    } else {\n                        this.customer_info = {...message, customer};\n                        resolve();\n                    }\n                });\n            });\n        } else {\n            return new Promise((resolve) => {\n                this.customer_info = {}\n                resolve();\n            });\n        }\n    }\n\n    show_discount_control() {\n        this.$add_discount_elem.css({'padding': '0px', 'border': 'none'});\n        this.$add_discount_elem.html(\n            `<div class=\"add-discount-field\"></div>`\n        );\n        const me = this;\n        const frm = me.events.get_frm();\n        let discount = frm.doc.additional_discount_percentage;\n\n        this.discount_field = frappe.ui.form.make_control({\n            df: {\n                label: __('Discount'),\n                fieldtype: 'Data',\n                placeholder: (discount ? discount + '%' : __('Enter discount percentage.')),\n                input_class: 'input-xs',\n                onchange: function () {\n                // frappe.run_serially([\n                //         ()=> me.update_additional_discount(me, this, frm, 'additional_discount_percentage'),\n                //     ])\n                    const input_ = this;\n                    setTimeout(function (){\n                        me.update_additional_discount(me, input_, frm, 'additional_discount_percentage')\n                    },1000)\n\n                    const grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? frm.doc.grand_total : frm.doc.rounded_total;\n                },\n\n            },\n            parent: this.$add_discount_elem.find('.add-discount-field'),\n            render_input: true,\n        });\n        this.discount_field.toggle_label(false);\n        this.discount_field.set_focus();\n    }\n\n    show_discount_amount_control() {\n        this.$add_discount_amount_elem.css({'padding': '0px', 'border': 'none'});\n        this.$add_discount_amount_elem.html(\n            `<div class=\"add-discount-amount-field\"></div>`\n        );\n        const me = this;\n        const frm = me.events.get_frm();\n        let discount = frm.doc.discount_amount;\n\n        this.discount_amount_field = frappe.ui.form.make_control({\n            df: {\n                label: __('Discount Amount'),\n                fieldtype: 'Data',\n                placeholder: (discount ? discount : __('Enter discount amount.')),\n                input_class: 'input-xs',\n                onchange: function () {\n                // frappe.run_serially([\n                //         ()=> me.update_additional_discount(me, this, frm, 'discount_amount'),\n                //     ])\n                const input_ = this;\n                setTimeout(function (){\n                    me.update_additional_discount(me, input_, frm, 'discount_amount')\n                },1000)\n            },\n\n            },\n            parent: this.$add_discount_amount_elem.find('.add-discount-amount-field'),\n            render_input: true,\n        });\n        this.discount_amount_field.toggle_label(false);\n        this.discount_amount_field.set_focus();\n    }\n\n    update_additional_discount(me, discount_section, frm, field_name){\n        if(field_name == 'additional_discount_percentage'){\n            if (flt(discount_section.value) != 0) {\n                frappe.model.set_value(frm.doc.doctype, frm.doc.name, field_name, flt(discount_section.value));\n                me.hide_discount_control(discount_section.value);\n                setTimeout(function (){\n                    me.hide_discount_amount_control(frm.doc.discount_amount);\n                }, 500)\n            } else {\n                frappe.model.set_value(frm.doc.doctype, frm.doc.name, field_name, 0);\n                me.$add_discount_elem.css({\n                    'border': '1px dashed var(--gray-500)',\n                    'padding': 'var(--padding-sm) var(--padding-md)'\n                });\n                me.$add_discount_elem.html(`${me.get_discount_icon()} Add Discount`);\n                me.discount_field = undefined;\n            }\n        }else{\n            if (discount_section !==0) {\n                const total_amount = parseFloat($(\".final-amount-total-label\").html())\n                if(total_amount == parseFloat(discount_section.value)){\n                    this.$add_discount_elem.css({'padding': '0px', 'border': 'none'});\n                    this.$add_discount_elem.html(\n                        `<div class=\"add-discount-field\"></div>`\n                    );\n                    frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', flt(100));\n                    me.hide_discount_amount_control(discount_section.value);\n                }else{\n                    this.$add_discount_elem.css({'padding': '0px', 'border': 'none'});\n                    this.$add_discount_elem.html(\n                        `<div class=\"add-discount-field\"></div>`\n                    );\n                    frappe.model.set_value(frm.doc.doctype, frm.doc.name, field_name, parseFloat(discount_section.value));\n                    me.hide_discount_amount_control(discount_section.value);\n                }\n            } else {\n                frappe.model.set_value(frm.doc.doctype, frm.doc.name, field_name, 0);\n                me.$add_discount_amount_elem.css({\n                    'border': '1px dashed var(--gray-500)',\n                    'padding': 'var(--padding-sm) var(--padding-md)'\n                });\n                me.$add_discount_amount_elem.html(`${me.get_discount_icon()} Add Discount`);\n                me.discount_amount_field = undefined;\n            }\n        }\n\n    }\n\n    hide_discount_control(discount) {\n        if (!discount) {\n            this.$add_discount_elem.css({'padding': '0px', 'border': 'none'});\n            this.$add_discount_elem.html(\n                `<div class=\"add-discount-field\"></div>`\n            );\n        } else {\n            this.$add_discount_elem.css({\n                'border': '1px dashed var(--dark-green-500)',\n                'padding': 'var(--padding-sm) var(--padding-md)'\n            });\n            this.$add_discount_elem.html(\n                `<div class=\"edit-discount-btn\">\n\t\t\t\t\t${this.get_discount_icon()} ${String(discount).bold()}% discount applied\n\t\t\t\t</div>`\n            );\n        }\n    }\n    hide_discount_amount_control(discount) {\n        if (!discount) {\n            this.$add_discount_amount_elem.css({'padding': '0px', 'border': 'none'});\n            this.$add_discount_amount_elem.html(\n                `<div class=\"add-discount-amount-field\"></div>`\n            );\n        } else {\n            this.$add_discount_amount_elem.css({\n                'border': '1px dashed var(--dark-green-500)',\n                'padding': 'var(--padding-sm) var(--padding-md)'\n            });\n            this.$add_discount_amount_elem.html(\n                `<div class=\"edit-discount-amount-btn\">\n\t\t\t\t\t${this.get_discount_icon()} ${String(discount).bold()}&nbsp;TK discount applied\n\t\t\t\t</div>`\n            );\n        }\n    }\n\n    update_pricing_rule_discount_section(ignore_pricing_rule=undefined) {\n        const me = this;\n        if(ignore_pricing_rule == undefined){\n            ignore_pricing_rule = this.ignore_pricing_rule;\n        }\n        this.$pricing_rule_discount_section.html(\n            `<div class=\"pricing-discount-details\">\n                <div class=\"pricing-discount-display\">\n                    <div class=\"pricing-discount-desc\">\n                        <div class=\"pricing-discount-name\">${ignore_pricing_rule}</div>\n                    </div>\n                    <div class=\"reset-ignore_pricing-rule-btn\" reset-ignore-pricing-rule-attr=\"\" data-pricing-discount=\"${escape(ignore_pricing_rule)}\">\n                        <svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n                            <path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n                        </svg>\n                    </div>\n                </div>\n            </div>`\n        );\n    }\n\n    update_served_by_section() {\n        const frm = this.events.get_frm();\n        let style=''\n        if(frm.doc.is_return){\n            style = \"display: none;\";\n        }\n\n        const {served_by} = this.served_by_info || {};\n        if (served_by) {\n            let served_by_name = served_by.split('-')[0]\n            this.$served_by_section.html(\n                `<div class=\"served-by-details\">\n\t\t\t\t\t<div class=\"served-by-display\">\n\t\t\t\t\t\t<div class=\"served-by-name-desc\">\n\t\t\t\t\t\t\t<div class=\"served-by-name\">${served_by_name}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-served-by-btn\" reset-served-attr=\"\" data-served-by=\"${escape(served_by)}\" style=\"${style}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n            );\n        } else {\n            this.reset_served_by_selector();\n        }\n\n    }\n\n    update_customer_section() {\n        const frm = this.events.get_frm();\n        let style=''\n        if(frm.doc.is_return){\n            style = \"display: none;\";\n        }\n        const {customer, customer_name, email_id = '', mobile_no = '', image} = this.customer_info || {};\n        if (customer) {\n            this.$customer_section.html(\n                `<div class=\"customer-details\">\n\t\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t\t<div class=\"customer-name\">${customer_name}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-customer-btn\" reset-customer-attr=\"\" data-customer=\"${escape(customer)}\" style=\"${style}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n            );\n        } else {\n            // reset customer selector\n            this.reset_customer_selector();\n        }\n\n        function get_customer_description() {\n            if (!email_id && !mobile_no) {\n                return `<div class=\"customer-desc\">Click to add email / phone</div>`;\n            } else if (email_id && !mobile_no) {\n                return `<div class=\"customer-desc\">${email_id}</div>`;\n            } else if (mobile_no && !email_id) {\n                return `<div class=\"customer-desc\">${mobile_no}</div>`;\n            } else {\n                return `<div class=\"customer-desc\">${email_id} - ${mobile_no}</div>`;\n            }\n        }\n\n    }\n\n    get_customer_image() {\n        const {customer, image} = this.customer_info || {};\n        if (image) {\n            return `<div class=\"customer-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n        } else {\n            return `<div class=\"customer-image customer-abbr\">${frappe.get_abbr(customer)}</div>`;\n        }\n    }\n\n    update_totals_section(frm) {\n        if (!frm) frm = this.events.get_frm();\n\n        this.render_net_total(frm.doc.net_total);\n        const grand_total = frm.doc.grand_total;\n        this.render_grand_total(grand_total);\n        this.render_taxes(frm.doc.taxes)\n        this.update_item_cart_total_section(frm)\n        this.render_rounded_total(frm.doc)\n\n    }\n\n    render_net_total(value) {\n        const currency = this.events.get_frm().doc.currency;\n        this.$totals_section.find('.net-total-container').html(\n            `<div>Net Total</div><div>${format_currency(value, currency)}</div>`\n        )\n\n        this.$numpad_section.find('.numpad-net-total').html(\n            `<div>Net Total: <span>${format_currency(value, currency)}</span></div>`\n        );\n    }\n\n    render_grand_total(value) {\n        const currency = this.events.get_frm().doc.currency;\n        this.$totals_section.find('.grand-total-container').html(\n            `<div>Grand Total</div><div>${value.toFixed(2)}</div>`\n        )\n\n        this.$numpad_section.find('.numpad-grand-total').html(\n            `<div>Grand Total: <span>${value.toFixed(2)}</span></div>`\n        );\n    }\n    // rabi\n    render_rounded_total(doc) {\n        const currency = this.events.get_frm().doc.currency;\n        let adjustment = doc.rounded_total - doc.grand_total;\n        this.$totals_section.find('.rounded-total-container').html(\n            `<div>Rounded Total</div><div>${format_currency(doc.rounded_total, currency)}</div>`\n        )\n        this.$totals_section.find('.rounding-adjustment-container').html(\n            `<div>Rounding Adjustment</div><div>${adjustment.toFixed(2)}</div>`\n        )\n        this.$totals_section.find('.special-discount-container').html(\n            `<div>Special Discount</div><div>${format_currency(doc.discount_amount, currency)}</div>`\n        )\n    }\n\n    render_taxes(taxes) {\n        if (taxes.length) {\n            const currency = this.events.get_frm().doc.currency;\n            const taxes_html = taxes.map(t => {\n                const description = /[0-9]+/.test(t.description) ? t.description : `${t.description} @ ${t.rate}%`;\n                return `<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, currency)}</div>\n\t\t\t\t</div>`;\n            }).join('');\n            this.$totals_section.find('.taxes-container').css('display', 'flex').html(taxes_html);\n        } else {\n            this.$totals_section.find('.taxes-container').css('display', 'none').html('');\n        }\n    }\n\n    get_cart_item({name}) {\n        const item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n        return this.$cart_items_wrapper.find(item_selector);\n    }\n\n    get_item_from_frm(item) {\n        const doc = this.events.get_frm().doc;\n        return doc.items.find(i => i.name == item.name);\n    }\n\n    update_item_html(item, remove_item) {\n        const $item = this.get_cart_item(item);\n\n        if (remove_item) {\n            $item && $item.next().remove() && $item.remove();\n        } else {\n            const item_row = this.get_item_from_frm(item);\n\n            this.render_cart_item(item_row, $item);\n            if(item_row.qty < 0){\n              frappe.model.set_value(item_row.doctype, item_row.name, 'pricing_rules', '')\n            }\n        }\n\n        const no_of_cart_items = this.$cart_items_wrapper.find('.cart-item-wrapper').length;\n        this.highlight_checkout_btn(no_of_cart_items > 0);\n        if(no_of_cart_items > 0){\n            $('.reset-ignore_pricing-rule-btn').css('display', 'none');\n            // $('.reset-customer-btn').css('display', 'none');\n        }else if(no_of_cart_items < 1){\n            $('.reset-ignore_pricing-rule-btn').css('display', 'flex');\n            // $('.reset-customer-btn').css('display', 'flex');\n        }\n\n        this.update_empty_cart_section(no_of_cart_items);\n        this.update_5_basis_rounded()\n\n        // console.log(frm);\n\n    }\n\n    update_5_basis_rounded(){\n        const frm = this.events.get_frm()\n        let grand_total = frm.doc.grand_total;\n        let rounded_total = 0\n        if(grand_total < 0){\n            rounded_total = Math.floor(grand_total)\n        }else{\n            rounded_total = Math.ceil(grand_total)\n        }\n        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'rounding_adjustment', rounded_total - grand_total)\n        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'rounded_total', rounded_total)\n        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'base_rounded_total', null)\n        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'base_paid_amount', null)\n        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'base_change_amount', null)\n        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'base_rounding_adjustment', null)\n    }\n    render_cart_item(item_data, $item_to_update) {\n        const frm = this.events.get_frm()\n        let items = frm.doc.items\n        const currency = frm.doc.currency;\n        const me = this;\n\n\n        if (!$item_to_update.length) {\n            this.$cart_items_wrapper.prepend(\n                `<div class=\"cart-item-wrapper\" data-row-name=\"${escape(item_data.name)}\"></div>\n\t\t\t\t<div class=\"seperator\"></div>`\n            )\n            $item_to_update = this.get_cart_item(item_data);\n        }\n        let style = \"\"\n        if(item_data.tag === \"NamINVMatroINVDam\"){\n            style = \"background-color:#7fffd4\"\n        }\n\n        $item_to_update.html(\n            `<div class=\"item-name-desc\" style=\"${style}\">\n                <div class=\"item-image-name-dec\">\n\t\t\t        <div class=\"item-image\" docname=\"${item_data.name}\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"/files/cross-icon.png\" alt=\"\"\">\n\t\t\t\t\t</div>\n\t\t\t        <div class=\"item-name\" >\n\t\t\t\t\t    <span>${frappe.ellipsis(item_data.item_name, 500)}</span>\n\t\t\t\t    </div>\n                </div>\n                ${get_rate_discount_html()}\n\t\t\t</div>`\n        )\n\n        set_dynamic_rate_header_width();\n\n        function set_dynamic_rate_header_width() {\n            const rate_cols = Array.from(me.$cart_items_wrapper.find(\".item-row-amount\"));\n            me.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n            me.$cart_items_wrapper.find(\".item-row-amount\").css(\"width\", \"\");\n            let max_width = rate_cols.reduce((max_width, elm) => {\n                if ($(elm).width() > max_width)\n                    max_width = $(elm).width();\n                return max_width;\n            }, 0);\n\n            max_width += 1;\n            if (max_width == 1) max_width = \"\";\n\n            me.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n            me.$cart_items_wrapper.find(\".item-row-amount\").css(\"width\", max_width);\n        }\n\n        function get_rate_discount_html() {\n            // if (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n            // \treturn `\n            // \t\t<div class=\"item-qty-rate\">\n            // \t\t\t<div class=\"item-qty\"><span>${item_data.qty || 0}</span></div>\n            // \t\t\t<div class=\"item-row-amount\">\n            // \t\t\t\t<div class=\"item-rate\">${format_currency(item_data.amount, currency)}</div>\n            // \t\t\t\t<div class=\"item-amount\">${format_currency(item_data.rate, currency)}</div>\n            // \t\t\t</div>\n            // \t\t</div>`\n            // } else {\n\n\n            // frappe.db.get_value('Item', item_data.item_code, 'standard_rate')\n            // \t.then(r => {\n            // \t\t// item_mrp = r.message.standard_rate;\n            // \t})\n\n            let is_return = (frm.doc.is_return ? 'enabled' : 'disabled');\n            let discount_amount = (item_data.discount_amount) || 0\n            let damaged_cost = (item_data.damaged_cost) || 0\n            let actual_discount_amount = discount_amount - damaged_cost // after adding damaged cost\n            return `\n\t\t\t\t\t<div class=\"item-row-mrp\"><span>${item_data.price_list_rate || 0}</span></div>\n\t\t\t\t\t<div class=\"item-row-disc\"><span>${actual_discount_amount || 0}</span></div>\n\t\t\t\t\t<div class=\"item-row-damaged\"><!--<span>${item_data.qty || 0}</span>-->\n\t\t\t\t\t<input class=\"form-control item-row-damaged damaged_cost\" type=\"text\" ${is_return} data-item-code=\"${item_data.item_code}\" data-index=\"${item_data.idx}\" data-rate=\"${item_data.rate || 0}\" data-damaged-rate=\"\" data-discount=\"\" value=\"${item_data.total_damaged_cost || 0}\" item_mrp_rate=\"${item_data.price_list_rate}\" docname=\"${item_data.name}\" discount_amount=\"${item_data.discount_amount}\" style=\"width: 50px;text-align: center;\" item_qty=\"${item_data.qty || 'undefined'}\">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-row-rate\"><span>${item_data.rate || 0}</span></div>\n\t\t\t\t\t<div class=\"item-row-qty\"><!--<span>${item_data.qty || 0}</span>-->\n\t\t\t\t\t<input class=\"form-control item_qty\" type=\"text\" data-tag=\"${item_data.price_rule_tag}\"data-rate=\"${item_data.rate || 0}\" value=\"${item_data.qty || 0}\" item_code=\"${item_data.item_code}\" docname=\"${item_data.name}\" style=\"width: 50px;text-align: center;\" free_item=\"${item_data.free_item_rules || 'undefined'}\">\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!--<div class=\"item-row-damaged-cost\">\n\t\t\t\t\t<input class=\"form-control damaged-cost\" type=\"text\" value=\"${item_data.qty || 0}\" item_code=\"${item_data.item_code}\" docname=\"${item_data.name}\" style=\"width: 50px;text-align: center;\">\n\t\t\t\t\t</div> -->\n\t\t\t\t\t<div class=\"item-row-amount\"><span>${item_data.amount || 0}</span></div>`\n            // }\n        }\n\n        function get_description_html() {\n            if (item_data.description) {\n                if (item_data.description.indexOf('<div>') != -1) {\n                    try {\n                        item_data.description = $(item_data.description).text();\n                    } catch (error) {\n                        item_data.description = item_data.description.replace(/<div>/g, ' ').replace(/<\\/div>/g, ' ').replace(/ +/g, ' ');\n                    }\n                }\n                item_data.description = frappe.ellipsis(item_data.description, 45);\n                return `<div class=\"item-desc\">${item_data.description}</div>`;\n            }\n            return ``;\n        }\n\n        function get_item_image_html() {\n            const {image, item_name} = item_data;\n            if (!me.hide_images && image) {\n                return `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n            } else {\n                return `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n            }\n        }\n\n        $(\".item_qty\").unbind().change(function(){\n            const item_qty_root = $(this);\n            let item_qty = $(this).val();\n\n            if(item_qty){\n                if(/^-?\\d+$/.test(item_qty) === true){\n\n                    let docname = $(this).attr('docname');\n                    let item_code = $(this).attr('item_code');\n                    let free_item = $(this).attr('free_item');\n                    let price_rule_tag = $(this).attr('data-tag');\n                    if(free_item !== 'undefined'){\n                        frappe.dom.unfreeze();\n                        frappe.show_alert({\n                            message: __('Item qty should be 1 for applied promotion'),\n                            indicator: 'orange'\n                        });\n                        frappe.utils.play_sound(\"error\");\n                        $(this).val(1)\n                        return\n                    }\n                    frappe.model.set_value(\"POS Invoice Item\", docname, 'qty', item_qty)\n                    frm.refresh();\n\n                    if(frm.doc.is_return == 1){\n                        // frappe.call({\n                        //     method: \"bbb.bbb.controllers.utils.apply_item_pricing_rule\",\n                        //     async:false,\n                        //     args: {\"return_against\": frm.doc.return_against, 'item_code': item_code},\n                        //     callback: (r) => {\n                                let damaged_cost_div = item_qty_root.parent().siblings('div.item-row-damaged').children('');\n                                let damaged_cost = damaged_cost_div.val();\n                                if(damaged_cost > 0){\n                                    // frappe.model.set_value(\"POS Invoice Item\", docname, 'margin_type', r.message.margin_type)\n                                    // frappe.model.set_value(\"POS Invoice Item\", docname, 'discount_percentage', r.message.discount_percentage).then(function(){\n                                        let item_wise_cost = Math.round(damaged_cost / item_qty);\n                                        let total_damaged_cost = item_wise_cost * item_qty;\n                                        let item_rate_discount = me.get_item_rate_discount(frm.doc.return_against, item_code)\n                                        let new_rate = (item_rate_discount.rate || 0) + item_wise_cost;\n                                        frappe.model.set_value(\"POS Invoice Item\", docname, 'damaged_cost', (-1 * item_wise_cost));\n                                        frappe.model.set_value(\"POS Invoice Item\", docname, 'rate', new_rate);\n                                        frappe.model.set_value(\"POS Invoice Item\", docname, 'total_damaged_cost', total_damaged_cost);\n                                        damaged_cost_div.val(total_damaged_cost);\n                                        me.update_item_cart_total_section(frm)\n                                        me.update_totals_section(frm)\n                                        frappe.model.set_value(\"POS Invoice Item\", docname, \"pricing_rules\", \"\")\n                                    // })\n                                }else {\n                                    // let item_rate_discount = me.get_item_rate_discount(frm.doc.return_against, item_code)\n                                    // frappe.model.set_value(\"POS Invoice Item\", docname, 'rate', parseInt(item_rate_discount.rate))\n\n                                    // frappe.model.set_value(\"POS Invoice Item\", docname, 'margin_type', r.message.margin_type)\n                                    // frappe.model.set_value(\"POS Invoice Item\", docname, 'discount_percentage', r.message.discount_percentage)\n\n                                }\n                                console.log(me.events.get_frm())\n                            // }\n                        // })\n                    }\n                    me.events.update_additional_discount_on_tag()\n\n                }else{\n                    const message = __('Item quantity must be a number');\n                    frappe.show_alert({\n                        indicator: 'red',\n                        message: message\n                    });\n\n                    $(this).val(item_qty)\n                }\n            }\n        });\n\n        $(\".damaged_cost\").on('change', function(){\n            let damaged_cost =  parseInt($(this).val());\n            if(isNaN(damaged_cost)){\n                $(this).val(0)\n                return;\n            }else {\n                if (frm.doc.is_return == 0) return;\n                let docname = $(this).attr('docname');\n                let item_qty = parseInt($(this).attr('item_qty'));\n                let damaged_cost = parseInt($(this).val());\n                let item_wise_cost = Math.round(damaged_cost / item_qty);\n                let total_damaged_cost = item_wise_cost * item_qty;\n                let data_item_code = $(this).attr('data-item-code');\n\n                frappe.call({\n                    method: \"bbb.bbb.controllers.utils.get_item_rate_discount\",\n                    args: {\"return_against\": frm.doc.return_against, 'item_code': data_item_code},\n                    callback: (r) => {\n                        let item = r.message;\n                        if (item) {\n                            let new_rate = (item.rate || 0) + item_wise_cost;\n                            frappe.model.set_value(\"POS Invoice Item\", docname, 'damaged_cost', (-1 * item_wise_cost));\n                            frappe.model.set_value(\"POS Invoice Item\", docname, 'rate', new_rate);\n                            frappe.model.set_value(\"POS Invoice Item\", docname, 'total_damaged_cost', total_damaged_cost);\n                            me.events.update_additional_discount_on_tag();\n                        } else {\n                            $(\".damaged_cost\").val(0);\n                        }\n                    }\n                })\n\n                $(this).val(total_damaged_cost);\n                me.update_item_cart_total_section(frm)\n            }\n        });\n        $(\".item-image\").on('click', function (){\n            if($('.edit-cart-btn').is(\":visible\") === true) return;\n            //rabi\n            frappe.dom.freeze();\n            let docname = $(this).attr('docname');\n            // console.log(docname);\n            let doctype = \"POS Invoice Item\"\n            let item = frappe.model.get_doc(doctype, docname);\n            const $item = me.get_cart_item(item);\n            // frappe.model.set_value(doctype, docname, 'qty', 0)\n            frappe.run_serially([\n                () => frappe.model.set_value(doctype, docname, 'rate', 0),\n                () => frappe.model.clear_doc(doctype, docname),\n                () => $item && $item.next().remove() && $item.remove(),\n                () => me.events.check_free_item_pricing_rules(),\n                // () => frappe.model.clear_doc(doctype, docname),\n                () => me.toggle_ignore_pricing_rule_button(),\n                () => me.update_item_cart_total_section(frm),\n                () => me.events.update_additional_discount_on_tag(),\n                () => frappe.dom.unfreeze()\n            ])\n        });\n    }\n    toggle_ignore_pricing_rule_button(){\n        const no_of_cart_items = this.$cart_items_wrapper.find('.cart-item-wrapper').length;\n        if(no_of_cart_items>0){\n            $('.reset-ignore_pricing-rule-btn').css('display', 'none');\n            // $('.reset-customer-btn').css('display', 'none');\n        }else if(no_of_cart_items < 1){\n            $('.reset-ignore_pricing-rule-btn').css('display', 'flex');\n            // $('.reset-customer-btn').css('display', 'flex');\n        }\n    }\n    handle_broken_image($img) {\n        const item_abbr = $($img).attr('alt');\n        $($img).parent().replaceWith(`<div class=\"item-image item-abbr\">${item_abbr}</div>`);\n    }\n\n    update_selector_value_in_cart_item(selector, value, item) {\n        const $item_to_update = this.get_cart_item(item);\n        $item_to_update.attr(`data-${selector}`, escape(value));\n    }\n\n    toggle_checkout_btn(show_checkout) {\n        if (show_checkout) {\n            this.$totals_section.find('.checkout-btn').css('display', 'flex');\n            this.$totals_section.find('.edit-cart-btn').css('display', 'none');\n            this.$add_discount_elem.find('input').removeAttr('disabled')\n            this.$add_discount_amount_elem.find('input').removeAttr('disabled')\n        } else {\n            this.$totals_section.find('.checkout-btn').css('display', 'none');\n            this.$totals_section.find('.edit-cart-btn').css('display', 'flex');\n        }\n    }\n\n    highlight_checkout_btn(toggle) {\n        if (toggle) {\n            this.$add_discount_elem.css('display', 'flex');\n            this.$add_discount_amount_elem.css('display', 'flex');\n            this.$cart_container.find('.checkout-btn').css({\n                'background-color': 'var(--blue-500)'\n            });\n        } else {\n            this.$add_discount_elem.css('display', 'none');\n            this.$add_discount_amount_elem.css('display', 'none');\n            this.$cart_container.find('.checkout-btn').css({\n                'background-color': 'var(--blue-200)'\n            });\n\n        }\n    }\n\n    update_empty_cart_section(no_of_cart_items) {\n        const $no_item_element = this.$cart_items_wrapper.find('.no-item-wrapper');\n\n        // if cart has items and no item is present\n        no_of_cart_items > 0 && $no_item_element && $no_item_element.remove() && this.$cart_header.css('display', 'flex');\n\n        no_of_cart_items === 0 && !$no_item_element.length && this.make_no_items_placeholder();\n    }\n\n    on_numpad_event($btn) {\n        const current_action = $btn.attr('data-button-value');\n        const action_is_field_edit = ['qty', 'discount_percentage', 'rate'].includes(current_action);\n        const action_is_allowed = action_is_field_edit ? (\n            (current_action == 'rate' && this.allow_rate_change) ||\n            (current_action == 'discount_percentage' && this.allow_discount_change) ||\n            (current_action == 'qty')) : true;\n\n        const action_is_pressed_twice = this.prev_action === current_action;\n        const first_click_event = !this.prev_action;\n        const field_to_edit_changed = this.prev_action && this.prev_action != current_action;\n\n        if (action_is_field_edit) {\n            if (!action_is_allowed) {\n                const label = current_action == 'rate' ? 'Rate'.bold() : 'Discount'.bold();\n                const message = __('Editing {0} is not allowed as per POS Profile settings', [label]);\n                frappe.show_alert({\n                    indicator: 'red',\n                    message: message\n                });\n                frappe.utils.play_sound(\"error\");\n                return;\n            }\n\n            if (first_click_event || field_to_edit_changed) {\n                this.prev_action = current_action;\n            } else if (action_is_pressed_twice) {\n                this.prev_action = undefined;\n            }\n            this.numpad_value = '';\n\n        } else if (current_action === 'checkout') {\n            this.prev_action = undefined;\n            this.toggle_item_highlight();\n            this.events.numpad_event(undefined, current_action);\n            return;\n        } else if (current_action === 'remove') {\n            this.prev_action = undefined;\n            this.toggle_item_highlight();\n            this.events.numpad_event(undefined, current_action);\n            return;\n        } else {\n            this.numpad_value = current_action === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + current_action;\n            this.numpad_value = this.numpad_value || 0;\n        }\n\n        const first_click_event_is_not_field_edit = !action_is_field_edit && first_click_event;\n\n        if (first_click_event_is_not_field_edit) {\n            frappe.show_alert({\n                indicator: 'red',\n                message: __('Please select a field to edit from numpad')\n            });\n            frappe.utils.play_sound(\"error\");\n            return;\n        }\n\n        if (flt(this.numpad_value) > 100 && this.prev_action === 'discount_percentage') {\n            frappe.show_alert({\n                message: __('Discount cannot be greater than 100%'),\n                indicator: 'orange'\n            });\n            frappe.utils.play_sound(\"error\");\n            this.numpad_value = current_action;\n        }\n\n        this.highlight_numpad_btn($btn, current_action);\n        this.events.numpad_event(this.numpad_value, this.prev_action);\n    }\n\n    highlight_numpad_btn($btn, curr_action) {\n        const curr_action_is_highlighted = $btn.hasClass('highlighted-numpad-btn');\n        const curr_action_is_action = ['qty', 'discount_percentage', 'rate', 'done'].includes(curr_action);\n\n        if (!curr_action_is_highlighted) {\n            $btn.addClass('highlighted-numpad-btn');\n        }\n        if (this.prev_action === curr_action && curr_action_is_highlighted) {\n            // if Qty is pressed twice\n            $btn.removeClass('highlighted-numpad-btn');\n        }\n        if (this.prev_action && this.prev_action !== curr_action && curr_action_is_action) {\n            // Order: Qty -> Rate then remove Qty highlight\n            const prev_btn = $(`[data-button-value='${this.prev_action}']`);\n            prev_btn.removeClass('highlighted-numpad-btn');\n        }\n        if (!curr_action_is_action || curr_action === 'done') {\n            // if numbers are clicked\n            setTimeout(() => {\n                $btn.removeClass('highlighted-numpad-btn');\n            }, 200);\n        }\n    }\n\n    toggle_numpad(show) {\n        if (show) {\n            this.$totals_section.css('display', 'none');\n            this.$numpad_section.css('display', 'flex');\n        } else {\n            this.$totals_section.css('display', 'flex');\n            this.$numpad_section.css('display', 'none');\n        }\n        this.reset_numpad();\n    }\n\n    reset_numpad() {\n        this.numpad_value = '';\n        this.prev_action = undefined;\n        this.$numpad_section.find('.highlighted-numpad-btn').removeClass('highlighted-numpad-btn');\n    }\n\n    toggle_numpad_field_edit(fieldname) {\n        if (['qty', 'discount_percentage', 'rate'].includes(fieldname)) {\n            this.$numpad_section.find(`[data-button-value=\"${fieldname}\"]`).click();\n        }\n    }\n\n    toggle_customer_info(show) {\n        if (show) {\n            const {customer} = this.customer_info || {};\n\n            this.$cart_container.css('display', 'none');\n            this.$customer_section.css({\n                'height': '100%',\n                'padding-top': '0px'\n            });\n            this.$customer_section.find('.customer-details').html(\n                `<div class=\"header\">\n\t\t\t\t\t<div class=\"label\">Contact Details</div>\n\t\t\t\t\t<div class=\"close-details-btn\">\n\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t<div class=\"customer-desc\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-fields-container\">\n\t\t\t\t\t<div class=\"email_id-field\"></div>\n\t\t\t\t\t<div class=\"mobile_no-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_program-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_points-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"transactions-label\">Recent Transactions</div>`\n            );\n            // transactions need to be in diff div from sticky elem for scrolling\n            this.$customer_section.append(`<div class=\"customer-transactions\"></div>`);\n\n            this.render_customer_fields();\n            this.fetch_customer_transactions();\n\n        } else {\n            this.$cart_container.css('display', 'flex');\n            this.$customer_section.css({\n                'height': '',\n                'padding-top': ''\n            });\n\n            this.update_customer_section();\n        }\n    }\n\n    render_customer_fields() {\n        const $customer_form = this.$customer_section.find('.customer-fields-container');\n\n        const dfs = [{\n            fieldname: 'email_id',\n            label: __('Email'),\n            fieldtype: 'Data',\n            options: 'email',\n            placeholder: __(\"Enter customer's email\")\n        }, {\n            fieldname: 'mobile_no',\n            label: __('Phone Number'),\n            fieldtype: 'Data',\n            placeholder: __(\"Enter customer's phone number\")\n        }, {\n            fieldname: 'loyalty_program',\n            label: __('Loyalty Program'),\n            fieldtype: 'Link',\n            options: 'Loyalty Program',\n            placeholder: __(\"Select Loyalty Program\")\n        }, {\n            fieldname: 'loyalty_points',\n            label: __('Loyalty Points'),\n            fieldtype: 'Data',\n            read_only: 1\n        }];\n\n        const me = this;\n        dfs.forEach(df => {\n            this[`customer_${df.fieldname}_field`] = frappe.ui.form.make_control({\n                df: {\n                    ...df,\n                    onchange: handle_customer_field_change,\n                },\n                parent: $customer_form.find(`.${df.fieldname}-field`),\n                render_input: true,\n            });\n            this[`customer_${df.fieldname}_field`].set_value(this.customer_info[df.fieldname]);\n        })\n\n        function handle_customer_field_change() {\n            const current_value = me.customer_info[this.df.fieldname];\n            const current_customer = me.customer_info.customer;\n\n            if (this.value && current_value != this.value && this.df.fieldname != 'loyalty_points') {\n                frappe.call({\n                    method: 'erpnext.selling.page.point_of_sale.point_of_sale.set_customer_info',\n                    args: {\n                        fieldname: this.df.fieldname,\n                        customer: current_customer,\n                        value: this.value\n                    },\n                    callback: (r) => {\n                        if (!r.exc) {\n                            me.customer_info[this.df.fieldname] = this.value;\n                            frappe.show_alert({\n                                message: __(\"Customer contact updated successfully.\"),\n                                indicator: 'green'\n                            });\n                            frappe.utils.play_sound(\"submit\");\n                        }\n                    }\n                });\n            }\n        }\n    }\n\n    fetch_customer_transactions() {\n        frappe.db.get_list('POS Invoice', {\n            filters: {customer: this.customer_info.customer, docstatus: 1},\n            fields: ['name', 'grand_total', 'status', 'posting_date', 'posting_time', 'currency'],\n            limit: 20\n        }).then((res) => {\n            const transaction_container = this.$customer_section.find('.customer-transactions');\n\n            if (!res.length) {\n                transaction_container.html(\n                    `<div class=\"no-transactions-placeholder\">No recent transactions found</div>`\n                )\n                return;\n            }\n            ;\n\n            const elapsed_time = moment(res[0].posting_date + \" \" + res[0].posting_time).fromNow();\n            this.$customer_section.find('.customer-desc').html(`Last transacted ${elapsed_time}`);\n\n            res.forEach(invoice => {\n                const posting_datetime = moment(invoice.posting_date + \" \" + invoice.posting_time).format(\"Do MMMM, h:mma\");\n                let indicator_color = {\n                    'Paid': 'green',\n                    'Draft': 'red',\n                    'Return': 'gray',\n                    'Consolidated': 'blue'\n                };\n\n                transaction_container.append(\n                    `<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t\t\t<div class=\"invoice-total\">\n\t\t\t\t\t\t\t\t${format_currency(invoice.grand_total, invoice.currency, 0) || 0}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"invoice-status\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color[invoice.status]}\">\n\t\t\t\t\t\t\t\t\t<span>${invoice.status}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"seperator\"></div>`\n                )\n            });\n        });\n    }\n\n    attach_refresh_field_event(frm) {\n        $(frm.wrapper).off('refresh-fields');\n        $(frm.wrapper).on('refresh-fields', () => {\n            if (frm.doc.items.length) {\n                frm.doc.items.forEach(item => {\n                    this.update_item_html(item);\n                });\n            }\n            this.update_totals_section(frm);\n        });\n    }\n    update_cached_data(cached_data){\n        const frm = this.events.get_frm();\n        const pos_ignore_pricing_rule = cached_data['pos_ignore_pricing_rule'] ? cached_data['pos_ignore_pricing_rule'] : \"No\"\n        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', cached_data['pos_customer']);\n        frm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n                frappe.run_serially([\n                () => this.fetch_customer_details(cached_data['pos_customer']),\n                () => this.events.customer_details_updated(this.customer_info),\n                () => this.update_customer_section(),\n                () => this.update_totals_section(),\n            ]);\n        })\n        frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'served_by', cached_data['pos_served_by']);\n        frm.script_manager.trigger('served_by', frm.doc.doctype, frm.doc.name).then(() => {\n            frappe.run_serially([\n                () => this.served_by_info = {'served_by': cached_data['pos_served_by']},\n                () => this.update_served_by_section(),\n            ]);\n        });\n        frappe.run_serially([\n            () => this.ignore_pricing_rule = pos_ignore_pricing_rule,\n            () => this.update_pricing_rule_discount_section(),\n            // () => this.ignore_pricing_discount(this, pos_ignore_pricing_rule),\n        ]);\n    }\n    get_cache_data(){\n\t\tfrappe.call({\n\t\t\tmethod: 'bbb.bbb.pos_invoice.get_pos_cached_data',\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\t// console.log(r.message);\n\t\t\t\t\treturn r.message;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n    load_invoice() {\n        const me = this;\n        const frm = this.events.get_frm();\n        frm.events.item_list = [];\n        this.attach_refresh_field_event(frm);\n        // const cached_data = this.events.get_cache_data();\n        // if(cached_data){\n        //     this.update_cached_data(cached_data)\n        // }\n        // else {\n        this.fetch_served_by_details(frm.doc.served_by).then(() => {\n            this.update_served_by_section();\n        });\n        this.fetch_discount_details(frm.doc.ignore_pricing_rule).then(() => {\n            this.update_pricing_rule_discount_section();\n        });\n        this.fetch_customer_details(frm.doc.customer).then(() => {\n            this.events.customer_details_updated(this.customer_info);\n            this.update_customer_section();\n        });\n        // }\n        this.$cart_items_wrapper.html('');\n        // pos return\n        // if(frm.doc.is_return == 1) {\n        // frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'ignore_pricing_rule', 0);\n        // }\n\n        // pos return\n        // if(frm.doc.is_return){\n        //     const item_data = frm.doc.items;\n        //     frm.doc.items = [];\n        //     frm.refresh_field('ignore_pricing_rule');\n        //     item_data.forEach(item => {\n        //         frappe.db.get_value('Item', {'item_code': item.item_code}, ['start_date', 'end_date', 'discount_amount']).then(res=>{\n        //             let new_item = {'item_code':item.item_code, 'batch_no': item.batch_no, 'rate':item.item_code, 'item_actual_qty': item.qty, 'mrp': item.price_list_rate, 'title': item.item_name, 'discount_amount': res.message.discount_amount, 'start_date': new Date(res.message.start_date), 'end_date': new Date(res.message.end_date), update_rules: 0}\n        //             var args = {\n        //             'field': \"qty\",\n        //             'item': new_item,\n        //             'value': item.qty\n        //             }\n        //             me.events.on_cart_update(args);\n        //         })\n        //     });\n        // }else{\n        //     if (frm.doc.items.length) {\n        //         frm.doc.items.forEach(item => {\n        //             this.update_item_html(item);\n        //         });\n        //     } else {\n        //         this.make_no_items_placeholder();\n        //         this.highlight_checkout_btn(false);\n        //     }\n        // }\n\n        if (frm.doc.items.length) {\n            frm.doc.items.forEach(item => {\n                this.update_item_html(item);\n            });\n        } else {\n            this.make_no_items_placeholder();\n            this.highlight_checkout_btn(false);\n        }\n         me.update_totals_section(frm);\n\n\n        // setTimeout(function (){\n        //     if (frm.doc.items.length) {\n        //         frm.doc.items.forEach(item => {\n        //             if(item.pricing_rules && item.discount_percentage <= 0){\n        //                 frappe.call({\n        //                     method: \"bbb.bbb.controllers.utils.get_pricing_rule_discount\",\n        //                     args: {\"name\": item.pricing_rules},\n        //                     callback: (r) => {\n        //                         frappe.model.set_value(item.doctype, item.name, 'discount_percentage', r.message.discount_percentage)\n        //                         me.update_item_html(item);\n        //                     }\n        //                 })\n        //             }else{\n        //                 me.update_item_html(item);\n        //             }\n        //         })\n        //     } else {\n        //         me.make_no_items_placeholder();\n        //         me.highlight_checkout_btn(false);\n        //     }\n        //\n        //     me.update_totals_section(frm);\n        // }, 5000);\n\n\n\n        if (frm.doc.docstatus === 1) {\n            this.$totals_section.find('.checkout-btn').css('display', 'none');\n            this.$totals_section.find('.edit-cart-btn').css('display', 'none');\n        } else {\n            this.$totals_section.find('.checkout-btn').css('display', 'flex');\n            this.$totals_section.find('.edit-cart-btn').css('display', 'none');\n        }\n        this.make_pos_profile();\n        this.toggle_component(true);\n        // if(cached_data){\n        //     const items = cached_data.pos_items ? cached_data.pos_items : {}\n        //     frm.doc.items = [];\n        //     frm.refresh_field('items');\n        //     frm.reload_doc();\n        //     items.forEach(item_dict => {\n        //         const values = Object.values(item_dict)[0];\n        //         var qty = values.qty;\n        //         var args = {\n        //         'field': \"qty\",\n        //         'item': values,\n        //         'value': \"+\" + qty\n        //         }\n        //         this.events.update_cached_item_data(args);\n        //     });\n        // }\n    }\n\n    toggle_component(show) {\n        show ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n    }\n\n    load_pricing_rules(){\n        const frm = this.events.get_frm();\n        if(!frm.doc.pricing_rules.length){\n            frappe.call({\n                method: \"bbb.bbb.controllers.utils.get_and_apply_item_pricing_rules\",\n                args: {\"return_against\": frm.doc.return_against},\n                callback: (r) => {\n                    let pricing_rules = r.message\n                    pricing_rules.forEach(pricing_rule => {\n                        let pricing_rule_detail = {'item_code': pricing_rule.item_code, 'pricing_rule': pricing_rule.pricing_rule}\n                        frm.add_child('pricing_rules', pricing_rule_detail);\n                    });\n                }\n            });\n        }\n    }\n\n\n    // ignore_pricing_discount(me) {\n\t// \t\t// var me = this;\n\t// \t\tvar item_list = [];\n    //\n\t// \t\t$.each(me.frm.doc[\"items\"] || [], function(i, d) {\n\t// \t\t\tif (d.item_code && !d.is_free_item) {\n\t// \t\t\t\titem_list.push({\n\t// \t\t\t\t\t\"doctype\": d.doctype,\n\t// \t\t\t\t\t\"name\": d.name,\n\t// \t\t\t\t\t\"item_code\": d.item_code,\n\t// \t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t// \t\t\t\t\t\"parenttype\": d.parenttype,\n\t// \t\t\t\t\t\"parent\": d.parent,\n\t// \t\t\t\t\t\"price_list_rate\": d.price_list_rate\n\t// \t\t\t\t})\n\t// \t\t\t}\n\t// \t\t});\n\t// \t\treturn this.frm.call({\n\t// \t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t// \t\t\targs: { item_list: item_list },\n\t// \t\t\tcallback: function(r) {\n\t// \t\t\t\tif (!r.exc && r.message) {\n\t// \t\t\t\t\tr.message.forEach(row_item => {\n\t// \t\t\t\t\t\tme.remove_pricing_rule(row_item);\n\t// \t\t\t\t\t});\n\t// \t\t\t\t\tme._set_values_for_item_list(r.message);\n\t// \t\t\t\t\tme.calculate_taxes_and_totals();\n\t// \t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t// \t\t\t\t}\n\t// \t\t\t}\n\t// \t\t});\n\t//\n\t// }\n\n    async ignore_pricing_discount(me, value) {\n        // const cached_data = me.events.get_cache_data();\n        // const items = cached_data['pos_items']\n        me.$cart_items_wrapper.empty();\n        var frm = me.events.get_frm();\n        var item_list = me.events.get_cart_items();\n        let update_rules = true\n        if (value === 'Yes') {\n            frm.doc.ignore_pricing_rule = 1;\n            update_rules = true\n            // frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'ignore_pricing_rule', 0);\n        } else if (value === 'No') {\n            frm.doc.ignore_pricing_rule = 0\n            update_rules = false\n            // frappe.model.set_value(frm.doc.doctype, frm.doc.name, 'ignore_pricing_rule', 1);\n        }\n        const item_data = frm.doc.items;\n        frm.doc.items = [];\n        frm.refresh_field('ignore_pricing_rule');\n        await item_data.forEach(item => {\n            frappe.db.get_value('Item', {'item_code': item.item_code}, ['start_date', 'end_date', 'discount_amount']).then(res=>{\n                let new_item = {'item_code':item.item_code, 'batch_no': item.batch_no, 'rate':item.item_code, 'qty': item.qty, 'mrp': item.price_list_rate, 'title': item.item_name, 'discount_amount': res.message.discount_amount, 'start_date': new Date(res.message.start_date), 'end_date': new Date(res.message.end_date), update_rules: update_rules}\n                var args = {\n                'field': \"qty\",\n                'item': new_item,\n                'value': \"+\" + item.qty\n                }\n                this.events.on_cart_update(args);\n            })\n        });\n        frm.reload_doc();\n        // console.log(frm.doc)\n    }\n\n    check_out_validation(show) {\n        if (!show) {\n            this.$totals_section.find('.checkout-btn').css('display', 'none');\n            this.$totals_section.find('.edit-cart-btn').css('display', 'none');\n        } else {\n            this.$totals_section.find('.checkout-btn').css('display', 'flex');\n            this.$totals_section.find('.edit-cart-btn').css('display', 'none');\n        }\n    }\n\n    // toggle_selector(enabled) {\n    //     this.$customer_section.find('.customer-section').setAttribute('disabled');\n    // }\n\n    update_item_cart_total_section(frm){\n        const item_section = $('.cart-item-wrapper').is(':visible');\n        if(item_section == true){\n            const items = frm.doc.items;\n            let total_mrp = 0;\n            let total_disc = 0;\n            let total_after_disc = 0;\n            let total_qty = 0;\n            let total_amount = frm.doc.total;\n            let total_damaged_cost = 0\n            items.forEach(item => {\n                total_mrp += parseFloat(item.price_list_rate);\n                total_after_disc += parseFloat(item.rate);\n                total_disc += (parseFloat(item.price_list_rate) - parseFloat(item.rate));\n                total_qty += item.qty;\n                total_damaged_cost += item.total_damaged_cost ? item.total_damaged_cost : 0;\n            });\n            $('.mrp-label').html(total_mrp);\n            $('.damaged-label').html(total_damaged_cost);\n            $('.disc-label').html(total_disc);\n            $('.after-disc-label').html(total_after_disc.toFixed(0));\n            $('.qty-label').html(total_qty);\n            $('.final-amount-total-label').html(total_amount.toFixed(0));\n\n            $('.total-section').css('visibility', 'visible');\n            //\n            // $('.mrp-label').html(format_currency(total_mrp, frm.doc.currency));\n            // $('.disc-label').html(format_currency(total_disc, frm.doc.currency));\n            // $('.after-disc-label').html(format_currency(total_after_disc.toFixed(0), frm.doc.currency));\n            // $('.qty-label').html(total_qty);\n            // $('.final-amount-total-label').html(format_currency(total_amount.toFixed(0), frm.doc.currency));\n        }else{\n            $('.total-section').css('visibility', 'hidden');\n        }\n\n    }\n\n    update_item_qty(){\n        const me = this;\n        const frm = me.events.get_frm()\n        let items = frm.doc.items;\n        // console.log(items);\n        if(items.length){\n            items.forEach(item => {\n                var item_qty = item.qty;\n                frappe.model.set_value(\"POS Invoice Item\", item.name, 'qty', 0)\n                    .then(function (){\n                        // console.log(item_qty)\n                        frappe.model.set_value(\"POS Invoice Item\", item.name, 'qty', item_qty)\n                            .then(function (){\n                                if(frm.doc.is_return){\n                                    frappe.call({\n                                        method: \"bbb.bbb.controllers.utils.apply_item_pricing_rule\",\n                                        args: {\"return_against\": frm.doc.return_against, 'item_code': item.item_code},\n                                        callback: (r) => {\n                                            frappe.model.set_value(\"POS Invoice Item\", item.name, 'margin_type', r.message.margin_type)\n                                            frappe.model.set_value(\"POS Invoice Item\", item.name, 'discount_percentage', r.message.discount_percentage)\n                                        }\n                                    })\n                                }\n                            })\n                    })\n\n            });\n\n        }\n\n    }\n\n\n    update_item_qty_(){\n        const me = this;\n        const frm = me.events.get_frm()\n        let items = frm.doc.items;\n        if(frm.doc.is_return && items.length){\n            frappe.call({\n                method: \"bbb.bbb.controllers.utils.apply_all_items_pricing_rules\",\n                // async:false,\n                args: {\"return_against\": frm.doc.return_against},\n                callback: (r) => {\n                    let item_list = r.message;\n                    items.forEach((item, index) => {\n                        var item_code = index + \"_\" + item.item_code\n                        const data = item_list.find(i => i.item_code === item_code);\n                        var item_qty = item.qty;\n                        frappe.model.set_value(\"POS Invoice Item\", item.name, 'rate', 0);\n                        frappe.model.set_value(\"POS Invoice Item\", item.name, 'qty', 0);\n                        frappe.model.set_value(\"POS Invoice Item\", item.name, 'rate', data.rate)\n                            .then(function () {\n                                frappe.model.set_value(\"POS Invoice Item\", item.name, 'qty', item_qty)\n                                    .then(function () {\n                                            frappe.model.set_value(\"POS Invoice Item\", item.name, 'margin_type', data.margin_type);\n                                            frappe.model.set_value(\"POS Invoice Item\", item.name, 'rate', data.rate);\n\n\n                                    })\n                            })\n                    })\n                }\n            })\n        }\n    }\n\n    get_item_rate_discount(return_against, item_code){\n        var rate = 0;\n        var discount_amount = 0;\n        var discount_percentage = 0;\n        frappe.call({\n            method: \"bbb.bbb.controllers.utils.get_item_rate_discount\",\n            args: {\"return_against\": return_against, 'item_code': item_code},\n            async: false,\n            callback: (r) => {\n                if(r.message){\n                    let item = r.message\n                    rate = item.rate;\n                    discount_amount = item.discount_amount;\n                    discount_percentage = item.discount_percentage;\n\n                // console.log(\"res\", {rate, discount_amount, discount_percentage})\n                }\n            }\n        })\n        return {rate, discount_amount, discount_percentage}\n    }\n\n    apply_item_pricing_rule(return_against, item_code){\n\n    }\n\n}\n"],
  "mappings": "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",
  "names": ["max_width", "damaged_cost"]
}
